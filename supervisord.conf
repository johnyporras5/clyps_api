[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisor/supervisord.pid

[program:nodejs]
command=node dist/src/main.js
directory=/app
user=nodejs
autostart=true
autorestart=true
startretries=10
startsecs=3
priority=100
# Output to both files AND stdout/stderr so Digital Ocean can capture it
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
# Also keep logs in files for debugging
stdout_logfile_backups=0
stderr_logfile_backups=0
# Inherit all environment variables from the container
# When 'environment' is not specified, supervisor automatically inherits ALL environment variables
# from the parent process (entrypoint.sh), which includes:
# - Variables passed via docker run -e or --env-file
# - Variables loaded from /app/.env file (if it exists)
# - Variables set in docker-compose.yml
# This ensures all environment variables are available to the Node.js process
stopwaitsecs=10

[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
startretries=3
startsecs=5
priority=200
stderr_logfile=/var/log/supervisor/nginx.err.log
stdout_logfile=/var/log/supervisor/nginx.out.log
user=root